<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
    <script>
      window.onload = function(){
        // ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 
        // We have to use window.onload so your JavaScript doesn't execute until the page has loaded and all HTML has been downloaded to your browser

        var user = prompt("User login required", "Username")
        title.innerHTML = "Welcome to " + user + "'s GeEmail!"

//RCGMCLOUD CODE
        var table = document.getElementById("tableBody");
        //table.innerHTML = "<tr><td>" + window.geemails[0].sender + "</td><td>" + window.geemails[0].subject + "</td><td>" + window.geemails[0].date + "</td></tr>";
        for (var i = 0; i < window.geemails.length; i++) {
        	table.innerHTML += "<tr onclick='showMessageInWindow("+i+")' class='emailrow'><td>" + window.geemails[i].sender + "</td><td>" + window.geemails[i].subject + "</td><td>" + window.geemails[i].date + "</td></tr>";	
        };
		setInterval(NeoMail, 10000);

		var rowNumber = document.getElementById("tableBody").rows.length;
        inboxNumber.innerHTML = rowNumber;

        var row = document.getElementsByClassName("emailrow");
//END RCGMCLOUD CODE
      };
//RCGMCLOUD CODE
            function showMessageInWindow(whichMessage){
      	var myWindow = window.open("", "_blank", "width=600, height=300");
      	var currentMessageObject = window.geemails[whichMessage];
      	myWindow.document.write("<p>Sender: " + currentMessageObject.sender + "<br/>" + "Subject: " + currentMessageObject.subject + "<br/>" + "Date: " + currentMessageObject.date + "<br/>"+  "<br/>" + "<br/>"+ currentMessageObject.body + "</p>");
      }

      function NeoMail(){
      	var table = document.getElementById("tableBody");
      	var message = getNewMessage();
      	var content = document.createElement("tr");
		
		content.className = "emailrow";
		currentRowNumber = document.getElementById("tableBody").rows.length + 1;
		
		content.innerHTML = "<td>"+ message.sender +"</td><td>"+ message.subject+"</td><td>"+ message.date+"</td>";

		content.onclick = function(currentRowNumber){
			showMessageInWindow(rowNumber);
		}

		table.appendChild(content);
		
		var rowNumber = document.getElementById("tableBody").rows.length;
        inboxNumber.innerHTML = rowNumber;

		

        window.geemails.push(message);
      };
//END RCGMCLOUD CODE

    </script>
	</head>
	<body>

		<div class="container" id="main">
			<div id="title">
		</div>
		<div class="container" id="inboxRow">
			<div id="inbox">
				<div id="inboxText">New Mail:</div>
				<div id = "inboxNumber"> </div>
			</div>
		</div>
		<div id="emailContainer">
			<table>
				<thead>
					<tr id="HEADERrow">
						<th id="from">FROM
						</th>
						<th id="subject">SUBJECT
						</th>
						<th id="date">RECIEVED ON
						</th>
					</tr>
				</thead>
				<tbody id="tableBody">
				</tbody>
			</table>
		</div>
	</body>
</html>